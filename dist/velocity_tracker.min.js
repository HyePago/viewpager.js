!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var o;"undefined"!=typeof window?o=window:"undefined"!=typeof global?o=global:"undefined"!=typeof self&&(o=self),o.VelocityTracker=e()}}(function(){return function e(o,r,n){function t(i,a){if(!r[i]){if(!o[i]){var c="function"==typeof require&&require;if(!a&&c)return c(i,!0);if(f)return f(i,!0);throw new Error("Cannot find module '"+i+"'")}var s=r[i]={exports:{}};o[i][0].call(s.exports,function(e){var r=o[i][1][e];return t(r?r:e)},s,s.exports,e,o,r,n)}return r[i].exports}for(var f="function"==typeof require&&require,i=0;i<n.length;i++)t(n[i]);return t}({1:[function(e,o){"use strict";function r(){function e(){return{MAX_DEGREE:4,time:0,xCoeff:new Array(5),yCoeff:new Array(5),degree:2,confidence:0,clear:function(){this.time=0,this.degree=0,this.confidence=0;for(var e=0;e<=this.MAX_DEGREE;e++)this.xCoeff[e]=0,this.yCoeff[e]=0}}}function o(e){console.log(JSON.stringify(e))}function r(e,o){for(var r=0,n=e.length;n--;)r+=e[n]*o[n];return r}function n(e){for(var o=0,r=e.length;r--;)o+=e[r]*e[r];return Math.sqrt(o)}function t(e,o){for(var r=new Array(e),n=0;e>n;n++)r[n]=new Array(o);return r}function f(){l=0,u[0]=void 0}function i(e,f,i,a,c,s,u){var l,d,v;g&&console.log("solveLeastSquares: ","m => ",a,"n => ",c,"x => ",e,"y => ",f,"w => ",i,"outB =>",s,"outDet =>",u);var y=t(c,a);for(l=0;a>l;l++)for(y[0][l]=i[l],d=1;c>d;d++)y[d][l]=y[d-1][l]*e[l];g&&o({a:y});var m=t(c,a),p=t(c,c);for(v=0;c>v;v++){for(l=0;a>l;l++)m[v][l]=y[v][l];for(d=0;v>d;d++){var w=r(m[v],m[d]);for(l=0;a>l;l++)m[v][l]-=w*m[d][l]}var x=n(m[v],a);if(g&&(o({q:m}),console.log("norm",x,a,m[v][0])),1e-6>x)return g&&console.log("  - no solution, norm=%f",x),!1;var h=1/x;for(l=0;a>l;l++)m[v][l]*=h;for(d=0;c>d;d++)p[v][d]=v>d?0:r(m[v],y[d])}if(g){console.log("  - q=> ",m[0][0]),console.log("  - r=> ",p[0][0]);var C=t(c,a);for(l=0;a>l;l++)for(d=0;c>d;d++)for(C[d][l]=0,v=0;c>v;v++)C[d][l]+=m[v][l]*p[v][d];console.log("  - qr=%s",C[0][0])}var A=new Array(a);for(l=0;a>l;l++)A[l]=f[l]*i[l];for(d=c;0!==d--;){for(s[d]=r(m[d],A,a),v=c-1;v>d;v--)s[d]-=p[d][v]*s[v];s[d]/=p[d][d]}g&&console.log("  - b=%s",s);var b=0;for(l=0;a>l;l++)b+=f[l];b/=a;var q=0,E=0;for(l=0;a>l;l++){var k=f[l]-s[0],M=1;for(d=1;c>d;d++)M*=e[l],k-=M*s[d];q+=i[l]*i[l]*k*k;var D=f[l]-b;E+=i[l]*i[l]*D*D}return u.confidence=E>1e-6?1-q/E:1,g&&console.log("  - sserr => ",q,"  - sstot => ",E,"  - det => ",u),!0}function a(){return 1}function c(e){d.clear();var o=new Array(y),r=new Array(y),n=new Array(y),t=new Array(y),f=0,c=l,s=u[l];if(void 0===s)return!1;do{var v=u[c];if(!v)break;var p=s.timestamp-v.timestamp;if(p>m)break;o[f]=v.x,r[f]=v.y,n[f]=a(c),t[f]=-p,c=(0===c?y:c)-1}while(++f<y);if(0===f)return console.log("no data to estimate"),!1;if(e>f-1&&(e=f-1),e>=1){var w={confidence:0},x={confidence:0},h=e+1;if(i(t,o,n,f,h,d.xCoeff,w)&&i(t,r,n,f,h,d.yCoeff,x))return d.time=s.timestamp,d.degree=e,d.confidence=w.confidence*x.confidence,g&&console.log("Estimate: ","degree",d.degree,"xCoeff",d.xCoeff,"yCoeff",d.yCoeff,"confidence",d.confidence),!0}return g&&console.log("velocity data available for this pointer, but we do have its current position."),d.xCoeff[0]=o[0],d.yCoeff[0]=r[0],d.time=s.timestamp,d.degree=0,d.confidence=1,!0}var s=0,u=new Array(y),l=0,d=new e,v=40,y=5,m=200,g=!1;return{clear:f,getVelocity:function(){return c(2)&&d.degree>=1?{unit:"px / ms",vx:d.xCoeff[1],vy:d.yCoeff[1]}:{info:"no velo",unit:"px / ms",vx:0,vy:0}},getPositions:function(){var e=0,o=l,r=[];do{var n=u[o];if(!n)break;r.push(n),o=(0===o?y:o)-1}while(++e<y);return r},addMovement:function(e){e.timestamp>=s+v&&(g&&console.log("no movements assume stop"),f()),s=e.timestamp,++l===y&&(l=0),u[l]=e}}}o.exports=r},{}]},{},[1])(1)});