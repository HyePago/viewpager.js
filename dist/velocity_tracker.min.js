!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var o;"undefined"!=typeof window?o=window:"undefined"!=typeof global?o=global:"undefined"!=typeof self&&(o=self),o.VelocityTracker=e()}}(function(){return function e(o,r,n){function t(i,a){if(!r[i]){if(!o[i]){var c="function"==typeof require&&require;if(!a&&c)return c(i,!0);if(f)return f(i,!0);throw new Error("Cannot find module '"+i+"'")}var s=r[i]={exports:{}};o[i][0].call(s.exports,function(e){var r=o[i][1][e];return t(r?r:e)},s,s.exports,e,o,r,n)}return r[i].exports}for(var f="function"==typeof require&&require,i=0;i<n.length;i++)t(n[i]);return t}({1:[function(e,o){"use strict";function r(){function e(){return{MAX_DEGREE:4,time:0,xCoeff:new Array(5),yCoeff:new Array(5),degree:2,confidence:0,clear:function(){this.time=0,this.degree=0,this.confidence=0;for(var e=0;e<=this.MAX_DEGREE;e++)this.xCoeff[e]=0,this.yCoeff[e]=0}}}function o(e){console.log(JSON.stringify(e))}function r(e,o){for(var r=0,n=e.length;n--;)r+=e[n]*o[n];return r}function n(e){for(var o=0,r=e.length;r--;)o+=e[r]*e[r];return Math.sqrt(o)}function t(e,o){for(var r=new Array(e),n=0;e>n;n++)r[n]=new Array(o);return r}function f(){m=0,v[0]=void 0}function i(e,f,i,a,c,s,u){var l,v,y;d&&console.log("solveLeastSquares: ","m => ",a,"n => ",c,"x => ",e,"y => ",f,"w => ",i,"outB =>",s,"outDet =>",u);var m=t(c,a);for(l=0;a>l;l++)for(m[0][l]=i[l],v=1;c>v;v++)m[v][l]=m[v-1][l]*e[l];d&&o({a:m});var g=t(c,a),p=t(c,c);for(y=0;c>y;y++){for(l=0;a>l;l++)g[y][l]=m[y][l];for(v=0;y>v;v++){var w=r(g[y],g[v]);for(l=0;a>l;l++)g[y][l]-=w*g[v][l]}var x=n(g[y],a);if(d&&(o({q:g}),console.log("norm",x,a,g[y][0])),1e-6>x)return d&&console.log("  - no solution, norm=%f",x),!1;var h=1/x;for(l=0;a>l;l++)g[y][l]*=h;for(v=0;c>v;v++)p[y][v]=y>v?0:r(g[y],m[v])}if(d){console.log("  - q=> ",g[0][0]),console.log("  - r=> ",p[0][0]);var C=t(c,a);for(l=0;a>l;l++)for(v=0;c>v;v++)for(C[v][l]=0,y=0;c>y;y++)C[v][l]+=g[y][l]*p[y][v];console.log("  - qr=%s",C[0][0])}var A=new Array(a);for(l=0;a>l;l++)A[l]=f[l]*i[l];for(v=c;0!==v--;){for(s[v]=r(g[v],A,a),y=c-1;y>v;y--)s[v]-=p[v][y]*s[y];s[v]/=p[v][v]}d&&console.log("  - b=%s",s);var b=0;for(l=0;a>l;l++)b+=f[l];b/=a;var q=0,E=0;for(l=0;a>l;l++){var k=f[l]-s[0],M=1;for(v=1;c>v;v++)M*=e[l],k-=M*s[v];q+=i[l]*i[l]*k*k;var D=f[l]-b;E+=i[l]*i[l]*D*D}return u.confidence=E>1e-6?1-q/E:1,d&&console.log("  - sserr => ",q,"  - sstot => ",E,"  - det => ",u),!0}function a(){return 1}function c(e){g.clear();var o=new Array(u),r=new Array(u),n=new Array(u),t=new Array(u),f=0,c=m,s=v[m];if(void 0===s)return!1;do{var y=v[c];if(!y)break;var p=s.timestamp-y.timestamp;if(p>l)break;o[f]=y.x,r[f]=y.y,n[f]=a(c),t[f]=-p,c=(0===c?u:c)-1}while(++f<u);if(0===f)return console.log("no data to estimate"),!1;if(e>f-1&&(e=f-1),e>=1){var w={confidence:0},x={confidence:0},h=e+1;if(i(t,o,n,f,h,g.xCoeff,w)&&i(t,r,n,f,h,g.yCoeff,x))return g.time=s.timestamp,g.degree=e,g.confidence=w.confidence*x.confidence,d&&console.log("Estimate: ","degree",g.degree,"xCoeff",g.xCoeff,"yCoeff",g.yCoeff,"confidence",g.confidence),!0}return d&&console.log("velocity data available for this pointer, but we do have its current position."),g.xCoeff[0]=o[0],g.yCoeff[0]=r[0],g.time=s.timestamp,g.degree=0,g.confidence=1,!0}var s=40,u=5,l=200,d=!1,v=new Array(u),y=0,m=0,g=new e;return{clear:f,getVelocity:function(){return c(2)&&g.degree>=1?{unit:"px / ms",vx:g.xCoeff[1],vy:g.yCoeff[1]}:{info:"no velo",unit:"px / ms",vx:0,vy:0}},getPositions:function(){var e=0,o=m,r=[];do{var n=v[o];if(!n)break;r.push(n),o=(0===o?u:o)-1}while(++e<u);return r},addMovement:function(e){e.timestamp>=y+s&&(d&&console.log("no movements assume stop"),f()),y=e.timestamp,++m===u&&(m=0),v[m]=e}}}o.exports=r},{}]},{},[1])(1)});